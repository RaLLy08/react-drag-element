<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello World</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <style>
    body {
      height: 100vh;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .dragEl {
      width: 100px;
      height: 100px;
      background-color: red;
      position: relative;
      cursor: grab;
    }
    .dragEl::before {
      content: "Drag me";
      position: absolute;
      transform: translate(-30%, -50%);
      top: 50%;
      left: 40%;
    }
  </style>
  <body>
    <div id="app"></div>
    <script type="text/babel">
      const DragEl = () => {
        const dragElDownEventRef = React.useRef();
        const [dragEl, setDragEl] = React.useState(null);
        const [clientXY, setClientXY] = React.useState({});

        React.useEffect(() => {
          document.onmousemove = (e) => {
            if (dragEl) {
              const { clientX, clientY } = e;
              setClientXY({
                x: clientX,
                y: clientY,
              });
            }
          };
          window.ontouchmove = (e) => {
            if (dragEl) {

              const { clientX, clientY } = e.changedTouches[e.changedTouches.length - 1];
              setClientXY({
                x: clientX,
                y: clientY,
              });
            }
          }
          document.onmouseup = () => {
            if (dragEl) {
              setDragEl(null);
              setClientXY({});
            }
          };
          document.ontouchend = (e) => {
            if (dragEl) {
              setDragEl(null);
              setClientXY({});
            }
          }
        }, [dragEl]);
        const mouseDownHanlder = (e, el) => {
          dragElDownEventRef.current = e;
          setDragEl(true);
        };

        const mouseTouchStartHandler = (e, el) => {
          dragElDownEventRef.current = e.changedTouches[e.changedTouches.length - 1];
          setDragEl(true);
        };
        console.log(clientXY);

        return (
          <div
            className="dragEl"
            style={
              dragEl
                ? {
                    transform: `translate(${
                      clientXY.x - dragElDownEventRef.current.clientX
                    }px, ${clientXY.y - dragElDownEventRef.current.clientY}px)`,
                    backgroundColor: "blue",
                    cursor: 'grabbing'
                  }
                : {}
            }
            onMouseDown={(e) => {
              e.preventDefault();
              mouseDownHanlder(e);
            }}
            onTouchStart={(e) => {
              mouseTouchStartHandler(e);
            }}
            draggable={false}
          >
            X:{clientXY.x}
            Y:{clientXY.y}
          </div>
        );
      };

      ReactDOM.render(<DragEl />, document.getElementById("app"));
    </script>
  </body>
</html>
